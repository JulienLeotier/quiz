<!-- chat/templates/chat/admin.html -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin page</title>
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
  {% if user.is_superuser %}
  <div class="row">
    <div class="col s12">
      <button id="start"  class="waves-effect waves-light btn-large" style="width: 100%;">
        Start</button>
    </div>
  </div>
  <div class="row">
    <div class="col s12">
      <ul class="tabs">
        <li class="tab col s3"><a class="active" href="#test1">Question</a></li>
        <li class="tab col s6"><a href="#test2">Score</a></li>
        <li class="tab col s3"><a href="#test3">Catégories</a></li>
      </ul>
    </div>
    <div id="test1" class="col s12">
      <div class="row">
        <div class="col s12 m12">
          <div class="card">
            <div class="card-content">
              <span class="card-title" id="question">Card Title</span>
            </div>
            <div class="card-action">
              <a href="#" id="resp">Response</a>
              <a href="#" id="suivantTrue">Correct</a>
              <a href="#" id="suivantFalse">Faux</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="test2" class="col s12">
      <div class="row">
        <div class="col s12">
          <table>
            <thead>
              <tr>
                <th>Pseudo</th>
                <th>Score</th>
              </tr>
            </thead>

            <tbody>
              {% for player in players %}
              <tr>
                <td id="{{player.user}}"><button id="{{player.user}}-button"
                    class="waves-effect waves-light btn-large">{{player.user}}</button></td>
                {% for score in scores %}
                {% if score.player == player%}
                <td id="{{player.user}}-score">{{score.score}}</td>
                {% endif %}
                {% endfor %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

    </div>
    <div id="test3" class="col s12">
      <div class="row">
        {% for categorie in categories %}
        {% if categorie.activate %}
        <div class="col s12 m4 center" style="margin-top:5%;">
          <button id="{{categorie.nameId}}"  class="waves-effect waves-light btn-large">
           {{categorie.name}}</button>
        </div>
        {% else %}
        <div class="col s12 m4 center" style="margin-top:5%;">
          <button id="{{categorie.nameId}}"  disabled class="waves-effect waves-light btn-large">
           {{categorie.name}}</button>
        </div>
        {% endif %}
       
        {% endfor %}
      </div>
    </div>
  </div>

  {{ room_name|json_script:"room-name" }}
  <!-- Compiled and minified JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script>
    var el = document.querySelector('.tabs');
    var instance = M.Tabs.init(el, {});
    const roomName = JSON.parse(document.getElementById('room-name').textContent);
    console.log(roomName)

    const chatSocket = new WebSocket(
      'ws://' +
      window.location.host +
      '/ws/' +
      roomName +
      '/'
    );

    chatSocket.onmessage = function (e) {
      const data = JSON.parse(e.data);
      if(data.type === 'score'){
        document.querySelector('#' + data.player + '-score').innerHTML = data.message
      }
      document.querySelector('#question').innerHTML = 'Question : ' + data.message.question || data.message
      document.querySelector('#resp').innerHTML = 'Réponse : ' + data.message.response || data.message
    };

    chatSocket.onclose = function (e) {
      console.error('Chat socket closed unexpectedly');
    };

    document.querySelector('#suivantTrue').onclick = function (e) {
      categorie = localStorage.getItem('categorie')
      player = localStorage.getItem('player')
      chatSocket.send(JSON.stringify({
        'message': {
          'type': 'question',
          'message': 'start',
          'response': 'ok',
          'categorie': categorie,
          'player': player
        }
      }));
    };
    document.querySelector('#suivantFalse').onclick = function (e) {
      categorie = localStorage.getItem('categorie')
      player = localStorage.getItem('player')
      chatSocket.send(JSON.stringify({
        'message': {
          'type': 'question',
          'message': 'start',
          'response': 'ko',
          'categorie': categorie,
          'player': player
        }
      }));
    };
    document.querySelector('#start').onclick = function (e) {
      categorie = localStorage.getItem('categorie')
      player = localStorage.getItem('player')
      chatSocket.send(JSON.stringify({
        'message': {
          'type': 'question',
          'message': 'start',
          'categorie': categorie,
          'player': player,
          'response': 'ko',
        }
      }));
    };
  </script>
  {% for player in players %}
  <script>
    var player = '#' + "{{player.user}}" + '-button';
    document.querySelector(player).onclick = function (e) {
      localStorage.setItem("player", "{{player.user}}")
    }
  </script>
  {% endfor %}
  {% for categorie in categories %}
  <script>
    var cat = '#' + "{{categorie.nameId}}";
    document.querySelector(cat).onclick = function (e) {
      localStorage.setItem("categorie", "{{categorie.name}}")
      document.querySelector('#' + "{{categorie.nameId}}").disabled = true;
    }
  </script>
  {% endfor %}
  {% else %}

  <div class="container">
    <p class="center">Vous n'avez rien à faire ici !</p>
    <a class="center" href="/1/"><img src="https://c.tenor.com/LMmBEVAOeXAAAAAC/tchip-sassy.gif"
        style="margin-left: 33%" /></a>
  </div>

  {% endif %}
</body>

</html>